<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>우리 아이 학교 유형 테스트 - 엘리하이 키즈</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* 기본 스타일 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Noto Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f8f9fa;
    }

    /* 헤더 스타일 */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .brand-logo {
      height: 32px;
      width: auto;
      background: #FFD135;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 800;
      font-size: 14px;
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin: 0;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* 관리자 링크 */
    .admin-link {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #6c757d;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      text-decoration: none;
      opacity: 0.7;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    .admin-link:hover {
      opacity: 1;
    }

    /* 반응형 헤더 */
    @media (max-width: 480px) {
      .header-title {
        font-size: 14px;
      }
      
      .app-header {
        padding: 12px 16px;
      }
      
      .brand-logo {
        height: 28px;
      }

      .admin-link {
        display: none;
      }
    }

    /* 컨테이너 */
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px;
    }

    /* 카드 */
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .card-soft {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
    }

    .hidden {
      display: none;
    }

    /* 타이틀 */
    .title {
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 8px;
      color: #333;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 24px;
      font-size: 14px;
    }

    /* 버튼 */
    .btn {
      border: none;
      border-radius: 12px;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn.primary {
      background: #FFD135;
      color: #333;
    }

    .btn.primary:hover {
      background: #ffcc00;
      transform: translateY(-1px);
    }

    .btn.outline {
      background: white;
      color: #FF6B35;
      border: 2px solid #FF6B35;
    }

    .btn.outline:hover {
      background: #FF6B35;
      color: white;
    }

    .btn.ghost {
      background: transparent;
      color: #666;
    }

    .btn.ghost:hover {
      background: #f8f9fa;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* 진행률 */
    .progress {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .bar {
      flex: 1;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-right: 12px;
    }

    .bar span {
      display: block;
      height: 100%;
      background: #FFD135;
      transition: width 0.3s ease;
    }

    .count {
      font-weight: 600;
      color: #666;
      font-size: 14px;
    }

    /* 질문 */
    .question {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      line-height: 1.4;
    }

    /* 옵션 */
    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .btn.option {
      background: white;
      border: 2px solid #e9ecef;
      color: #333;
      text-align: left;
      padding: 20px;
      font-size: 15px;
      font-weight: 500;
      line-height: 1.4;
    }

    .btn.option:hover {
      border-color: #FFD135;
      background: #fffbf0;
    }

    .btn.option.selected {
      border-color: #FFD135;
      background: #FFD135;
      color: #333;
    }

    /* 네비게이션 */
    .nav {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .nav .btn {
      flex: 1;
    }

    /* 결과 */
    .result-head {
      text-align: center;
      margin-bottom: 24px;
    }

    .pill {
      display: inline-block;
      background: #FFD135;
      color: #333;
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(255, 209, 53, 0.3);
      position: relative;
    }

    .pill::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      background: linear-gradient(45deg, rgba(255, 209, 53, 0.2), rgba(255, 107, 53, 0.1));
      border-radius: 50px;
      z-index: -1;
    }

    .result-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
      color: #333;
    }

    /* 결과 이미지 */
    .result-image {
      text-align: center;
      margin-bottom: 24px;
    }

    .result-image img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }

    /* 공유 */
    .share {
      text-align: center;
    }

    .note {
      font-size: 13px;
      color: #666;
      line-height: 1.5;
      margin-bottom: 16px;
    }

    .note a {
      color: #FF6B35;
      text-decoration: none;
    }

    .note a:hover {
      text-decoration: underline;
    }

    .actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .actions .btn {
      flex: 1;
      max-width: 200px;
    }

    /* 관리자 페이지 스타일 */
    .admin-page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .admin-header {
      background: #dc3545;
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      text-align: center;
    }

    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      text-align: center;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 800;
      color: #FFD135;
      margin-bottom: 8px;
    }

    .stat-label {
      color: #666;
      font-size: 14px;
    }

    .results-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .table-header {
      background: #f8f9fa;
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .results-list {
      max-height: 600px;
      overflow-y: auto;
    }

    .result-item {
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: grid;
      grid-template-columns: 120px 1fr 100px 80px;
      gap: 16px;
      align-items: center;
    }

    .result-item:hover {
      background: #f8f9fa;
    }

    .result-timestamp {
      font-size: 12px;
      color: #666;
    }

    .result-answers {
      font-family: monospace;
      font-size: 14px;
      color: #333;
    }

    .result-type {
      font-weight: 600;
      color: #FF6B35;
    }

    .clear-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .clear-btn:hover {
      background: #c82333;
    }

    /* 푸터 */
    .app-footer {
      text-align: center;
      padding: 20px;
      color: #999;
      font-size: 12px;
    }

    /* 반응형 */
    @media (max-width: 480px) {
      .container {
        padding: 16px;
      }
      
      .card {
        padding: 20px;
      }
      
      .title {
        font-size: 22px;
      }
      
      .question {
        font-size: 18px;
      }
      
      .result-title {
        font-size: 24px;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .actions .btn {
        max-width: none;
      }

      .result-item {
        grid-template-columns: 1fr;
        gap: 8px;
        text-align: left;
      }

      .admin-stats {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand-logo">ELIHIGH KIDS</div>
    <h1 class="header-title">우리 아이에게 추천하는 학교는?</h1>
  </header>

  <main class="container">
    <!-- 인트로 -->
    <section id="intro" class="card">
      <h1 class="title">우리 아이 학교 유형 테스트</h1>
      <p class="subtitle">10문항 · 약 2분 · 모바일 최적화</p>
      <button id="startBtn" class="btn primary">시작하기</button>
    </section>

    <!-- 퀴즈 -->
    <section id="quiz" class="card hidden">
      <div class="progress">
        <div class="bar"><span id="barFill" style="width:0%"></span></div>
        <div class="count"><span id="qIndex">1</span> / 10</div>
      </div>
      <h2 id="qText" class="question"></h2>
      <div class="options">
        <button id="optA" class="btn option">A</button>
        <button id="optB" class="btn option">B</button>
      </div>
      <div class="nav">
        <button id="prevBtn" class="btn ghost" disabled>이전</button>
        <button id="nextBtn" class="btn primary" disabled>다음</button>
      </div>
    </section>

    <!-- 결과 -->
    <section id="result" class="card hidden">
      <div class="result-head">
        <p class="pill">추천 결과</p>
        <h2 id="topType" class="result-title"></h2>
      </div>

      <div class="result-image">
        <img id="resultImg" alt="결과 이미지" />
      </div>

      <div class="share card-soft">
        <p class="note">
          더 자세한 비교·체크리스트는
          <a href="http://files.mbest.co.kr/www/elihigh/kids/elihigh_kids_250724.pdf" target="_blank" rel="noopener">월간 슬기로운 초등준비 9월호</a>에서 확인하세요.<br>
          본 결과는 참고용입니다. 아이 특성·가족 상황·지역 여건을 함께 고려해 최종 결정해주세요.
        </p>
        <div class="actions">
          <button id="shareTest" class="btn primary">테스트 공유하기</button>
          <button id="retry" class="btn outline">다시하기</button>
        </div>
      </div>
    </section>

    <!-- 관리자 페이지 -->
    <section id="adminPage" class="admin-page hidden">
      <div class="admin-header">
        <h1>📊 테스트 결과 관리자 페이지</h1>
        <p>고객들의 테스트 결과를 확인할 수 있습니다</p>
      </div>

      <div class="admin-stats">
        <div class="stat-card">
          <div class="stat-number" id="totalTests">0</div>
          <div class="stat-label">총 테스트 완료</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="publicSchool">0</div>
          <div class="stat-label">공립초등학교</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="privateSchool">0</div>
          <div class="stat-label">사립초등학교</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="nationalSchool">0</div>
          <div class="stat-label">국립초등학교</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="intlSchool">0</div>
          <div class="stat-label">국제학교⋅외국인학교</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="altSchool">0</div>
          <div class="stat-label">대안학교</div>
        </div>
      </div>

      <div class="results-table">
        <div class="table-header">
          <h3>테스트 결과 목록</h3>
          <button id="clearResults" class="clear-btn">전체 삭제</button>
        </div>
        <div class="results-list" id="resultsList">
          <div style="padding: 40px; text-align: center; color: #666;">
            아직 수집된 결과가 없습니다.
          </div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 30px;">
        <button id="backToTest" class="btn outline">테스트로 돌아가기</button>
      </div>
    </section>
  </main>

  <!-- 관리자 페이지 링크 (데스크톱에서만 표시) -->
  <a href="#admin" class="admin-link" id="adminLink">관리자</a>

  <footer class="app-footer">
    <small>All rights reserved. Copyright ⓒ 2025 by MegastudyEdu Co., Ltd.</small>
  </footer>

  <script>
    // 질문 데이터
    const QUESTIONS = [
      { q: "우리 아이는 어떤 친구 관계를 더 편안해하나요?",
        a: "같은 아파트(동네) 친구들과 자주 만나 놀고, 함께 다니는 걸 좋아해요.",
        b: "처음 만난 친구와도 금방 어울리고, 새로운 모임에도 잘 끼어요." },
      { q: "우리 아이는 어떤 방식의 칭찬을 더 좋아하나요?",
        a: "칭찬스티커/도장처럼 '기준을 채우면 주는 보상'을 좋아해요.",
        b: "'여기 이렇게 해서 좋았어'처럼 아이가 한 걸 자세히 봐주는 칭찬에 더 동기가 생겨요." },
      { q: "우리 아이는 시끌벅적한 자리에서 어떻게 반응하나요?",
        a: "행사나 소리가 큰 곳에서는 쉽게 지치고, 조용한 곳을 찾으려 해요.",
        b: "떠들썩해도 잠깐 쉬면 다시 잘 놀고 금방 적응해요." },
      { q: "우리 가족은 아이 교육에서 무엇을 더 우선하나요?",
        a: "기본기부터 탄탄하게 쌓고, 체계적으로 학습하는 걸 더 중시해요.",
        b: "협력·탐구·체험 같은 과정과 경험에서 배우는 성장을 더 중시해요." },
      { q: "우리 아이는 특별히 선호하는 특성화 활동이 있나요?",
        a: "피아노/미술/체육/언어 같은 '특별 활동'에 깊은 관심과 선호가 있어요.",
        b: "별히 선호하는 '특별 활동'이 있지는 않아요." },
      { q: "우리 아이는 언어·다문화 노출에 어떻게 반응하나요?",
        a: "한국어 설명이 편하고, 영어는 노래 따라 부르기 정도면 충분해요.",
        b: "간단한 영어 지시·놀이도 좋아하고, 다른 문화 이야기에도 호기심이 커요." },
      { q: "우리 가족은 기관(유치원)과의 소통에서 어떤 방식을 더 선호하나요?",
        a: "알림장/가정통신문처럼 일정이 정리되어 오는 방식이면 충분해요.",
        b: "사진·영상 공유, 설명회·행사 안내처럼 자주 소통해 주면 더 안심돼요." },
      { q: "우리 아이는 어떤 활동에서 더 몰입하나요?",
        a: "따라 쓰기, 숫자 세기, 책 읽기처럼 '차근차근 따라하는 활동'에서 더 집중해요.",
        b: "만들기, 실험, 발표·공연, 체험처럼 '자유롭게 표현하는 활동'에 더 성취감을 느껴요." },
      { q: "우리 가족은 학교 선택·지원 방식에 대해 어떻게 생각하나요?",
        a: "배정된 학교로 가는 일반 절차가 마음이 편하고, 추가 지원은 부담돼요.",
        b: "아이와 잘 맞는 학교를 찾기 위해 지원/면접 절차를 시간을 들여 알아보고, 고액의 학비도 부담할 의향이 있어요." },
      { q: "우리 가족은 통학·생활 방식에서 무엇을 더 중요하게 보나요?",
        a: "통학 시간은 최대한 짧게, 안정적인 생활 환경을 가졌으면 해요.",
        b: "좋은 학교라면 장거리 통학이나 기숙학교도 선택할 수 있어요." }
    ];

    // 학교 유형별 가중치
    const WEIGHTS = {
      "공립": {
        A: [2, 1, 1, 2, 0, 1, 2, 2, 2, 3],
        B: [0, 0, 0, 0, 2, 0, 0, 0, 0, 0]
      },
      "국립": {
        A: [0, 1, 0, 1, 1, 1, 0, 1, 1, 0],
        B: [1, 1, 1, 1, 0, 0, 2, 1, 1, 1]
      },
      "사립": {
        A: [1, 0, 0, 1, 2, 0, 0, 0, 0, 0],
        B: [0, 2, 1, 1, 0, 1, 2, 1, 1, 1]
      },
      "대안": {
        A: [1, 0, 2, 0, 0, 0, 0, 0, 0, 0],
        B: [0, 2, 0, 2, 0, 0, 0, 2, 1, 1]
      },
      "외국인": {
        A: [0, 0, 0, 0, 2, 0, 0, 0, 0, 0],
        B: [1, 0, 1, 0, 0, 2, 0, 1, 2, 3]
      }
    };

    // 타이브레이커 우선순위
    const TIE_PRIOR = {
      "10A": ["공립", "국립", "사립", "대안", "외국인"],
      "10B": ["사립", "외국인", "대안", "국립", "공립"],
      "1A": ["공립", "대안", "국립", "사립", "외국인"],
      "1B": ["국립", "사립", "외국인", "공립", "대안"],
      "6A": ["공립", "국립", "대안", "사립", "외국인"],
      "6B": ["사립", "외국인", "국립", "대안", "공립"],
      "4A": ["공립", "국립", "사립", "외국인", "대안"],
      "4B": ["대안", "국립", "사립", "공립", "외국인"],
      "3A": ["대안", "사립", "공립", "국립", "외국인"],
      "3B": ["국립", "사립", "외국인", "공립", "대안"]
    };

    // 학교 유형별 결과 텍스트
    const SCHOOL_RESULTS = {
      "공립": "공립초등학교",
      "사립": "사립초등학교", 
      "국립": "국립초등학교",
      "외국인": "국제학교⋅외국인학교",
      "대안": "대안학교"
    };

    // 전역 상태
    let currentQ = 0;
    let answers = [];

    // DOM 요소들
    let intro, quiz, result, adminPage, startBtn, qText, optA, optB;
    let prevBtn, nextBtn, qIndex, barFill, topType, resultImg;
    let shareBtn, retryBtn, adminLink, backToTestBtn, clearResultsBtn;

    // 결과 저장 함수
    function saveTestResult(answers, resultType) {
      try {
        const timestamp = new Date().toISOString();
        const testResult = {
          id: Date.now(),
          timestamp: timestamp,
          answers: answers.join(''),
          result: resultType,
          date: new Date().toLocaleDateString('ko-KR'),
          time: new Date().toLocaleTimeString('ko-KR')
        };

        // 기존 결과들 가져오기
        const existingResults = JSON.parse(localStorage.getItem('testResults') || '[]');
        existingResults.push(testResult);
        
        // 저장 (최대 1000개까지만 저장)
        if (existingResults.length > 1000) {
          existingResults.splice(0, existingResults.length - 1000);
        }
        
        localStorage.setItem('testResults', JSON.stringify(existingResults));
        console.log('테스트 결과 저장 완료');
      } catch (error) {
        console.error('결과 저장 실패:', error);
      }
    }

    // 관리자 통계 업데이트
    function updateAdminStats() {
      try {
        const results = JSON.parse(localStorage.getItem('testResults') || '[]');
        
        // 전체 테스트 수
        document.getElementById('totalTests').textContent = results.length;

        // 각 학교 유형별 카운트
        const counts = {
          '공립': 0,
          '사립': 0, 
          '국립': 0,
          '외국인': 0,
          '대안': 0
        };

        results.forEach(result => {
          if (counts.hasOwnProperty(result.result)) {
            counts[result.result]++;
          }
        });

        document.getElementById('publicSchool').textContent = counts['공립'];
        document.getElementById('privateSchool').textContent = counts['사립'];
        document.getElementById('nationalSchool').textContent = counts['국립'];
        document.getElementById('intlSchool').textContent = counts['외국인'];
        document.getElementById('altSchool').textContent = counts['대안'];

      } catch (error) {
        console.error('통계 업데이트 실패:', error);
      }
    }

    // 결과 목록 표시
    function displayResultsList() {
      try {
        const results = JSON.parse(localStorage.getItem('testResults') || '[]');
        const resultsList = document.getElementById('resultsList');
        
        if (results.length === 0) {
          resultsList.innerHTML = `
            <div style="padding: 40px; text-align: center; color: #666;">
              아직 수집된 결과가 없습니다.
            </div>
          `;
          return;
        }

        // 최신 순으로 정렬
        results.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        resultsList.innerHTML = results.map(result => `
          <div class="result-item">
            <div>
              <div class="result-timestamp">${result.date}</div>
              <div class="result-timestamp">${result.time}</div>
            </div>
            <div class="result-answers">${result.answers}</div>
            <div class="result-type">${SCHOOL_RESULTS[result.result]}</div>
            <div style="text-align: center;">
              <button onclick="deleteResult(${result.id})" class="clear-btn" style="font-size: 12px; padding: 4px 8px;">삭제</button>
            </div>
          </div>
        `).join('');

      } catch (error) {
        console.error('결과 목록 표시 실패:', error);
      }
    }

    // 개별 결과 삭제
    function deleteResult(id) {
      if (confirm('이 결과를 삭제하시겠습니까?')) {
        try {
          const results = JSON.parse(localStorage.getItem('testResults') || '[]');
          const filteredResults = results.filter(result => result.id !== id);
          localStorage.setItem('testResults', JSON.stringify(filteredResults));
          updateAdminStats();
          displayResultsList();
        } catch (error) {
          console.error('결과 삭제 실패:', error);
        }
      }
    }

    // 전체 결과 삭제
    function clearAllResults() {
      if (confirm('모든 테스트 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
        try {
          localStorage.removeItem('testResults');
          updateAdminStats();
          displayResultsList();
          alert('모든 결과가 삭제되었습니다.');
        } catch (error) {
          console.error('전체 결과 삭제 실패:', error);
        }
      }
    }

    // DOM 초기화 함수
    function initializeDOM() {
      try {
        intro = document.getElementById('intro');
        quiz = document.getElementById('quiz');
        result = document.getElementById('result');
        adminPage = document.getElementById('adminPage');
        startBtn = document.getElementById('startBtn');
        qText = document.getElementById('qText');
        optA = document.getElementById('optA');
        optB = document.getElementById('optB');
        prevBtn = document.getElementById('prevBtn');
        nextBtn = document.getElementById('nextBtn');
        qIndex = document.getElementById('qIndex');
        barFill = document.getElementById('barFill');
        topType = document.getElementById('topType');
        resultImg = document.getElementById('resultImg');
        shareBtn = document.getElementById('shareTest');
        retryBtn = document.getElementById('retry');
        adminLink = document.getElementById('adminLink');
        backToTestBtn = document.getElementById('backToTest');
        clearResultsBtn = document.getElementById('clearResults');

        return true;
      } catch (error) {
        console.error('DOM 초기화 실패:', error);
        return false;
      }
    }

    // 타이브레이커 함수
    function applyTiebreaker(tiedSchools, answers) {
      try {
        const questionsToCheck = [9, 0, 5, 3, 2];

        for (const qIndex of questionsToCheck) {
          if (qIndex < 0 || qIndex >= answers.length || !answers[qIndex]) continue;
          
          const key = (qIndex + 1) + answers[qIndex];
          const priorityList = TIE_PRIOR[key];
          
          if (!priorityList) continue;

          for (const school of priorityList) {
            if (tiedSchools.includes(school)) {
              return school;
            }
          }
        }

        return tiedSchools[0];
      } catch (error) {
        console.error('타이브레이커 적용 실패:', error);
        return tiedSchools[0];
      }
    }

    // 결과 계산 함수
    function showResult() {
      try {
        const scores = {};
        
        // 점수 계산
        for (const type in WEIGHTS) {
          scores[type] = 0;
          
          for (let i = 0; i < answers.length; i++) {
            if (i >= QUESTIONS.length) break;
            
            if (answers[i] === 'A' && WEIGHTS[type].A && WEIGHTS[type].A[i] !== undefined) {
              scores[type] += WEIGHTS[type].A[i];
            } else if (answers[i] === 'B' && WEIGHTS[type].B && WEIGHTS[type].B[i] !== undefined) {
              scores[type] += WEIGHTS[type].B[i];
            }
          }
        }
        
        // 최고 점수 찾기
        let topSchools = [];
        let maxScore = Math.max(...Object.values(scores));
        
        for (const type in scores) {
          if (scores[type] === maxScore) {
            topSchools.push(type);
          }
        }
        
        // 타이브레이커 적용
        let finalSchool = topSchools[0];
        if (topSchools.length > 1) {
          finalSchool = applyTiebreaker(topSchools, answers);
        }

        // 결과 저장 (새로 추가)
        saveTestResult(answers, finalSchool);
        
        // 결과 표시
        if (topType) {
          topType.textContent = SCHOOL_RESULTS[finalSchool] || '추천 결과';
        }
        
        // 결과 이미지는 실제 이미지 파일이 없으므로 텍스트로 대체
        if (resultImg) {
          resultImg.style.display = 'none';
        }
        
        // 화면 전환
        if (quiz) quiz.classList.add('hidden');
        if (result) result.classList.remove('hidden');
        
      } catch (error) {
        console.error('결과 계산 실패:', error);
        alert('결과 계산 중 오류가 발생했습니다. 다시 시도해주세요.');
      }
    }

    // 관리자 페이지 표시
    function showAdminPage() {
      // 모든 섹션 숨기기
      if (intro) intro.classList.add('hidden');
      if (quiz) quiz.classList.add('hidden');
      if (result) result.classList.add('hidden');
      
      // 관리자 페이지 표시
      if (adminPage) {
        adminPage.classList.remove('hidden');
        updateAdminStats();
        displayResultsList();
      }
    }

    // 테스트로 돌아가기
    function backToTest() {
      if (adminPage) adminPage.classList.add('hidden');
      if (intro) intro.classList.remove('hidden');
    }

    // 이벤트 리스너 등록
    function setupEventListeners() {
      try {
        if (startBtn) startBtn.addEventListener('click', startQuiz);
        if (optA) optA.addEventListener('click', () => selectOption('A'));
        if (optB) optB.addEventListener('click', () => selectOption('B'));
        if (prevBtn) prevBtn.addEventListener('click', prevQuestion);
        if (nextBtn) nextBtn.addEventListener('click', nextQuestion);
        if (shareBtn) shareBtn.addEventListener('click', shareTest);
        if (retryBtn) retryBtn.addEventListener('click', restart);
        if (adminLink) adminLink.addEventListener('click', (e) => {
          e.preventDefault();
          showAdminPage();
        });
        if (backToTestBtn) backToTestBtn.addEventListener('click', backToTest);
        if (clearResultsBtn) clearResultsBtn.addEventListener('click', clearAllResults);

        // URL 해시 체크 (admin 페이지 직접 접근)
        if (window.location.hash === '#admin') {
          showAdminPage();
        }

        // 전역 함수로 등록 (삭제 버튼용)
        window.deleteResult = deleteResult;

      } catch (error) {
        console.error('이벤트 리스너 등록 실패:', error);
      }
    }

    // 퀴즈 시작
    function startQuiz() {
      try {
        if (intro) intro.classList.add('hidden');
        if (quiz) quiz.classList.remove('hidden');
        showQuestion();
      } catch (error) {
        console.error('퀴즈 시작 실패:', error);
      }
    }

    // 질문 표시
    function showQuestion() {
      try {
        if (currentQ < 0 || currentQ >= QUESTIONS.length) return;
        
        const q = QUESTIONS[currentQ];
        if (qText) qText.textContent = q.q || '';
        if (optA) optA.textContent = q.a || '';
        if (optB) optB.textContent = q.b || '';

        if (qIndex) qIndex.textContent = currentQ + 1;
        if (barFill) {
          barFill.style.width = ((currentQ + 1) / QUESTIONS.length * 100) + '%';
        }

        // 선택 상태 초기화
        if (optA) optA.classList.remove('selected');
        if (optB) optB.classList.remove('selected');
        if (nextBtn) nextBtn.disabled = true;

        // 이전 선택 복원
        if (answers[currentQ]) {
          const selectedOpt = answers[currentQ] === 'A' ? optA : optB;
          if (selectedOpt) selectedOpt.classList.add('selected');
          if (nextBtn) nextBtn.disabled = false;
        }

        // 이전 버튼 상태
        if (prevBtn) prevBtn.disabled = currentQ === 0;
      } catch (error) {
        console.error('질문 표시 실패:', error);
      }
    }

    // 옵션 선택
    function selectOption(option) {
      try {
        if (optA) optA.classList.remove('selected');
        if (optB) optB.classList.remove('selected');
        
        const selectedOpt = option === 'A' ? optA : optB;
        if (selectedOpt) selectedOpt.classList.add('selected');

        answers[currentQ] = option;
        if (nextBtn) nextBtn.disabled = false;
      } catch (error) {
        console.error('옵션 선택 실패:', error);
      }
    }

    // 이전 질문
    function prevQuestion() {
      try {
        if (currentQ > 0) {
          currentQ--;
          showQuestion();
        }
      } catch (error) {
        console.error('이전 질문 이동 실패:', error);
      }
    }

    // 다음 질문
    function nextQuestion() {
      try {
        if (currentQ < QUESTIONS.length - 1) {
          currentQ++;
          showQuestion();
        } else {
          showResult();
        }
      } catch (error) {
        console.error('다음 질문 이동 실패:', error);
      }
    }

    // 공유하기
    function shareTest() {
      try {
        const url = window.location.href.split('#')[0]; // 해시 제거
        const text = '우리 아이 학교 유형 테스트 - 엘리하이 키즈';
        
        if (navigator.share) {
          navigator.share({
            title: text,
            text: '우리 아이에게 맞는 학교 유형을 찾아보세요!',
            url: url
          }).catch(err => console.log('공유 실패:', err));
        } else if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(`${text}\n${url}`)
            .then(() => alert('링크가 클립보드에 복사되었습니다!'))
            .catch(() => fallbackCopy(url));
        } else {
          fallbackCopy(url);
        }
      } catch (error) {
        console.error('공유 실패:', error);
        fallbackCopy(window.location.href.split('#')[0]);
      }
    }

    // 폴백 복사 함수
    function fallbackCopy(text) {
      let textarea = null;
      try {
        textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        
        const success = document.execCommand('copy');
        if (success) {
          alert('링크가 클립보드에 복사되었습니다!');
        } else {
          throw new Error('복사 실패');
        }
      } catch (err) {
        console.error('복사 실패:', err);
        alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + text);
      } finally {
        if (textarea && textarea.parentNode) {
          textarea.parentNode.removeChild(textarea);
        }
      }
    }

    // 다시하기
    function restart() {
      try {
        currentQ = 0;
        answers = [];
        if (result) result.classList.add('hidden');
        if (adminPage) adminPage.classList.add('hidden');
        if (intro) intro.classList.remove('hidden');
      } catch (error) {
        console.error('재시작 실패:', error);
      }
    }

    // 초기화
    document.addEventListener('DOMContentLoaded', function() {
      if (initializeDOM()) {
        setupEventListeners();
        console.log('퀴즈 애플리케이션이 성공적으로 초기화되었습니다.');
      } else {
        console.error('퀴즈 애플리케이션 초기화에 실패했습니다.');
      }
    });
  </script>
</body>
</html>
